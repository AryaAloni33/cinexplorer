<!DOCTYPE html>
<html>
<head>
    <title>CinExplorer - Movie App</title>

    <style>
        /* ============================
           NETFLIX MOVING RED/BLACK BG
        ============================= */
        body {
            background: radial-gradient(circle at 20% 20%, rgba(255,0,0,0.25), transparent 60%),
                        radial-gradient(circle at 80% 80%, rgba(255,0,0,0.18), transparent 70%),
                        #0a0a0a;
            background-size: 200% 200%;
            animation: netflixBG 14s ease-in-out infinite;
            color: white;
            font-family: Arial;
            padding: 30px;
            text-align: center;
        }

        @keyframes netflixBG {
            0%   { background-position: 0% 0%; }
            50%  { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        /* Inputs + Buttons */
        #searchBox {
            width: 300px;
            padding: 10px;
            font-size: 17px;
            border-radius: 8px;
            border: none;
        }

        #btn, #genreBtn {
            padding: 10px 20px;
            font-size: 17px;
            background: #ff4444;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            margin-left: 8px;
        }

        /* MOVIE GRID */
        #movies {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .movie {
            background: #ffffff22;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            backdrop-filter: blur(4px);
        }
        .movie:hover {
            background: #ffffff44;
        }

        .movie img {
            width: 100%;
            border-radius: 12px;
        }

        /* POPUP */
        #popup {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.77);
            justify-content: center;
            align-items: center;
        }

        #popupBox {
            width: 60%;
            background: #222;
            padding: 20px;
            border-radius: 12px;
            text-align: left;
        }

        #closeBtn {
            float: right;
            font-size: 22px;
            color: red;
            cursor: pointer;
        }

        #popupContent img {
            width: 200px;
            float: left;
            margin-right: 20px;
            border-radius: 12px;
        }

        #trailerBtn {
            margin-top: 20px;
            padding: 10px 18px;
            background: #ff0000;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
        }

        /* RECOMMENDED (DOOM SCROLL) */
        #recommendedMoviesWrapper {
            overflow: hidden;
            width: 100%;
            margin-top: 30px;
        }

        #recommendedMovies {
            display: flex;
            gap: 20px;
            white-space: nowrap;
            animation: scrollMovies 40s linear infinite;
        }

        #recommendedMovies:hover {
            animation-play-state: paused;
        }

        .recMovie {
            width: 180px;
            min-width: 180px;
            background: #ffffff22;
            padding: 10px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            backdrop-filter: blur(4px);
        }

        @keyframes scrollMovies {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
    </style>
</head>

<body>

<h1>ðŸŽ¬ CinExplorer</h1>

<!-- SEARCH -->
<input id="searchBox" type="text" placeholder="Search movies...">
<button id="btn">Search</button>

<!-- GENRE + YEAR FILTER -->
<div style="margin-top:20px;">
    <select id="genreSelect" style="padding:10px; border-radius:6px;">
        <option value="">Select Genre</option>
        <option>Action</option>
        <option>Adventure</option>
        <option>Animation</option>
        <option>Comedy</option>
        <option>Crime</option>
        <option>Drama</option>
        <option>Fantasy</option>
        <option>Horror</option>
        <option>Mystery</option>
        <option>Romance</option>
        <option>Sci-Fi</option>
        <option>Thriller</option>
    </select>

    <select id="yearSelect" style="padding:10px; border-radius:6px;">
        <option value="">Year</option>
    </select>

    <button id="genreBtn">Filter</button>
</div>

<!-- RECOMMENDED -->
<h2 style="margin-top:40px;">ðŸ”¥ Recommended Movies</h2>
<div id="recommendedMoviesWrapper">
    <div id="recommendedMovies"></div>
</div>

<!-- MOVIE RESULTS -->
<div id="movies"></div>

<!-- POPUP -->
<div id="popup">
    <div id="popupBox">
        <span id="closeBtn">X</span>
        <div id="popupContent"></div>
    </div>
</div>

<script>
/* ============================
   API KEYS
============================ */
const API_KEY = "2f01ef65"; // OMDb
const TMDB_KEY = "5e6e637d3c50c76e787a423b632f4ac9"; // TMDB

let currentPage = 1;
let currentSearch = "";

/* ============================
   YEAR DROPDOWN
============================ */
const yearDropdown = document.getElementById("yearSelect");
for (let y = 2025; y >= 1980; y--) {
    yearDropdown.innerHTML += `<option value="${y}">${y}</option>`;
}

/* ============================
   RECOMMENDED MOVIES LIST
============================ */
const recommendedList = [
    "Inception","Interstellar","Joker","Avengers","Titanic",
    "The Dark Knight","Fight Club","Avatar","Deadpool",
    "Iron Man","Spider-Man","John Wick","Dune","The Matrix",
    "Gladiator","Oppenheimer","Barbie","Black Panther",
    "Shutter Island","Logan"
];

/* ============================
   LOAD RECOMMENDED (FIXED)
============================ */
function loadRecommended() {
    const recDiv = document.getElementById("recommendedMovies");
    const fullList = [...recommendedList, ...recommendedList];

    fullList.forEach(movie => {
        fetch(`https://www.omdbapi.com/?apikey=${API_KEY}&t=${movie}`)
            .then(res => res.json())
            .then(data => {
                if (!data || data.Response === "False") return;

                const poster = (data.Poster && data.Poster !== "N/A")
                    ? data.Poster
                    : "https://via.placeholder.com/200x300?text=No+Image";

                recDiv.innerHTML += `
                    <div class="recMovie" onclick="getDetails('${data.imdbID}','${data.Title}')">
                        <img src="${poster}">
                        <p>${data.Title}</p>
                    </div>
                `;
            });
    });
}

loadRecommended();

/* ============================
   SEARCH MOVIES
============================ */
document.getElementById("btn").onclick = () => {
    let query = document.getElementById("searchBox").value.trim();
    if (!query) return alert("Enter a movie name");

    currentSearch = query;
    currentPage = 1;

    fetchMovies(query, currentPage, true);
};

function fetchMovies(query, page, clear) {
    fetch(`https://www.omdbapi.com/?apikey=${API_KEY}&s=${query}&page=${page}`)
        .then(res => res.json())
        .then(data => {
            if (clear) document.getElementById("movies").innerHTML = "";
            if (data.Response === "False") {
                document.getElementById("movies").innerHTML = "<h2>No results</h2>";
                return;
            }

            data.Search.forEach(movie => {
                document.getElementById("movies").innerHTML += `
                    <div class="movie" onclick="getDetails('${movie.imdbID}','${movie.Title}')">
                        <img src="${movie.Poster}">
                        <div class="movie-title">${movie.Title}</div>
                        <div>${movie.Year}</div>
                    </div>
                `;
            });
        });
}

/* ============================
   STREAMING INFO (TMDB)
============================ */
async function getStreamingPlatforms(title) {
    try {
        const searchUrl = `https://api.themoviedb.org/3/search/movie?api_key=${TMDB_KEY}&query=${encodeURIComponent(title)}`;
        const searchRes = await fetch(searchUrl);
        const searchData = await searchRes.json();

        if (!searchData.results?.length) return "Not available";

        const movieId = searchData.results[0].id;

        const providerUrl = `https://api.themoviedb.org/3/movie/${movieId}/watch/providers?api_key=${TMDB_KEY}`;
        const providerRes = await fetch(providerUrl);
        const providerData = await providerRes.json();

        const india = providerData.results.IN;
        if (!india?.flatrate) return "Not available for streaming in India";

        return india.flatrate.map(p => p.provider_name).join(" â€¢ ");
    } catch (err) {
        return "Streaming info unavailable";
    }
}

/* ============================
   MOVIE DETAILS POPUP
============================ */
async function getDetails(id, title) {
    const movie = await fetch(`https://www.omdbapi.com/?apikey=${API_KEY}&i=${id}&plot=full`)
        .then(res => res.json());

    const platforms = await getStreamingPlatforms(title);

    document.getElementById("popupContent").innerHTML = `
        <img src="${movie.Poster}">
        <h2>${movie.Title} (${movie.Year})</h2>
        <p><b>IMDb:</b> ${movie.imdbRating}</p>
        <p><b>Genre:</b> ${movie.Genre}</p>
        <p><b>Actors:</b> ${movie.Actors}</p>
        <p><b>Plot:</b> ${movie.Plot}</p>

        <p><b>ðŸ“º Where to Watch:</b><br>${platforms}</p>

        <button id="trailerBtn" onclick="openTrailer('${title}')">
            â–¶ Watch Trailer
        </button>
    `;

    document.getElementById("popup").style.display = "flex";
}

/* ============================
   TRAILER
============================ */
function openTrailer(title) {
    window.open(
        `https://www.youtube.com/results?search_query=${encodeURIComponent(title + " official trailer")}`,
        "_blank"
    );
}

document.getElementById("closeBtn").onclick = () => {
    document.getElementById("popup").style.display = "none";
};
</script>

</body>
</html>
